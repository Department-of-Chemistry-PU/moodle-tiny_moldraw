<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="Ketcher is a web-based chemical structure editor" />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="./favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="./favicon-16x16.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="./apple-touch-icon.png" />
    <link rel="manifest" href="./manifest.json" />
    <title>Ketcher v2.15.0</title>
    <script defer="defer" src="./static/js/main.963f80c2.js"></script>
    <link href="./static/css/main.3fc9c0f8.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<<<<<<< HEAD
	<style>
	#actionButton {
  font-weight: bold; /* Make the text bold */
  border-radius: 12px; /* Rounded corners */
  padding: 10px 24px; /* Some padding */
  text-align: center; /* Centered text */
  text-decoration: none; /* Remove underline */
  display: inline-block;
  font-size: 16px;
  transition-duration: 0.4s; /* Transition effect */
  cursor: pointer; /* Add a mouse pointer on hover */
  float: right;
}

#actionButton:active { /* Change background color when button is clicked */
  box-shadow: 0 5px #666;
  transform: translateY(4px);
}

/* Style for "Preview" state */
#actionButton[data-state="preview"] {
  background-color: grey; /* Grey background */
  color: white; /* White text */
  border: 2px solid grey; /* Grey border */
}

#actionButton[data-state="preview"]:hover {
  background-color: white;
  color: grey;
}

/* Style for "Confirm & Close" state */
#actionButton[data-state="confirm"] {
  background-color: green; /* Green background */
  color: white; /* White text */
  border: 2px solid green; /* Green border */
}

#actionButton[data-state="confirm"]:hover {
  background-color: white;
  color: green;
}
</style>
  </head>
  <body><noscript>You need to enable JavaScript to run this app.</noscript>
    <div class="center">
      <div id="root"></div>
      <div>
	Change Size for best visualization: <br>
	<label for="width">Width:</label><input style="width:5ch;" type="text" id="width" name="width" value="50" oninput="outputImage()">&nbsp;&nbsp;
	<label for="height">Height:</label><input style="width:5ch;" type="text" id="height" name="height" value="50" oninput="outputImage()">
	<button id="actionButton" onclick="handleClick();">Preview</button>
	</div>
	<div id="output"></div>
    </div>
    <script>
      var ketcher = null;

	var isPreview = true;

	async function handleClick() {
	  var button = document.getElementById("actionButton");
	  if (isPreview) {
		button.setAttribute('data-state', 'preview');
	    await outputImage(); // Wait for outputImage() to finish
	    button.innerHTML = "Confirm & Close"; // Change the button label
		button.setAttribute('data-state', 'confirm');
	    isPreview = false;
	  } else {
	    closeModal(); // Invoke closeModal() function
	  }
	}


      function blobToBase64(blob) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onloadend = () => resolve(reader.result);
          reader.onerror = reject;
          reader.readAsDataURL(blob);
        });
      }

      function outputImage() {
        var output = document.getElementById("output");
        var width = document.getElementById("width").value;
        var height = document.getElementById("height").value;
        ketcher.getKet().then(struct => ketcher.generateImage(struct, {
          outputFormat: "svg",
          backgroundColor: "255, 255, 255"
        })).then(blob => blobToBase64(blob)).then(base64 => {
          var img = document.createElement('img');
          img.src = base64;
          img.width = width;
          img.height = height;
          output.innerHTML = '';
          output.appendChild(img);
        }).catch(error => window.alert(error));
      }

      // Expose the dataURI and ketData to the parent window
      function getData() {
        return new Promise((resolve, reject) => {
          ketcher.getKet().then(struct => {
            ketcher.generateImage(struct, {
              outputFormat: "svg",
              backgroundColor: "255, 255, 255",
            }).then(blob => blobToBase64(blob)).then(base64 => {
              resolve({
                dataURI: base64,
                ketData: struct,
              });
            }).catch(reject);
          }).catch(reject);
        });
      }
      // Make the function accessible from the parent window
      window.getData = getData;

      function closeModal() {
        console.log('closeModal called');
        var width = document.getElementById('width');
        var height = document.getElementById('height');
        console.log(height);
        getData().then(({
              dataURI,
              ketData
            }) => {
              console.log('dataURI:', dataURI);
              console.log('ketData:', ketData);
              if (window.parent.tinyMCE && window.parent.tinyMCE.activeEditor) { // Check if TinyMCE is initialized
                var content = '<img src="' + dataURI + '" width="' + width.value + 'px" height="' + height.value + 'px">';
                console.log('content:', content); // Print the content to the console
                window.parent.tinyMCE.activeEditor.execCommand('mceInsertContent', 0, content);
                window.parent.tinyMCE.activeEditor.execCommand('mceInsertContent', 0, ' <!--<p id="ketdata">'+ketData+'</p>-->');
                  }
                  else {
                    console.log('TinyMCE not initialized');
                  }
                  $(window.parent.document).find(".modal").find('.close').click();
                }).catch(error => {
                console.error('ERROR IN GETDATA', error);
                alert(error);
              });
            }
    </script>
  </body>
=======
  </head>
  <body>
  <noscript>You need to enable JavaScript to run this app.</noscript>
  <div class="center">
    <div id="root"></div>
<p>
  <label for="width">Width:</label>
  <input type="text" id="width" name="width" value="100">
</p>
<p>
  <label for="height">Height:</label>
  <input type="text" id="height" name="height" value="100">
</p>
    <p><button class="sketchsubmit" onclick="exportMOLfile();">Export Molecule in Molfile</button></p>
	<p id="output">output:</p>
  </div>
<script>
  var ketcher = null;

  function blobToBase64(blob) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onloadend = () => resolve(reader.result);
      reader.onerror = reject;
      reader.readAsDataURL(blob);
    });
  }
  function outputImage() {
	var output = document.getElementById("output");
    ketcher.getKet().then(struct => ketcher.generateImage(struct, {
      outputFormat: "svg",
      backgroundColor: "255, 255, 255"
    })).then(blob => blobToBase64(blob)).then(base64 => {
      var img = document.createElement('img');
      img.src = base64;
      output.innerHTML = '';
	output.appendChild(img);
    }).catch(error => window.alert(error));
  }

  ///export to parent tinymce textarea as image the ketcher xml format
function exportMOLfile() {
outputImage();
var width = document.getElementById('width');
var height = document.getElementById('height');
    getData().then(({ dataURI, ketData }) => {
      console.log('dataURI:', dataURI);  // Print dataURI to the console
      console.log('ketData:', ketData);  // Print ketData to the console
      window.parent.tinyMCE.activeEditor.execCommand('mceInsertContent', 0, '<img src="'+dataURI+'" width="'+width.value+'px" height="'+height.value+'px">');
      window.parent.tinyMCE.activeEditor.execCommand('mceInsertContent', 0, '<!--[ketdata]'+ketData+'[/ketData]');
      $(window.parent.document).find(".modal").find('.close').click();
    }).catch(error => {
      console.error(error);
      alert(error);
    });
  }
    // Expose the dataURI and ketData to the parent window
  function getData() {
  return new Promise((resolve, reject) => {
    ketcher.getKet().then(struct => {
      ketcher.generateImage(struct, {
        outputFormat: "svg",
        backgroundColor: "255, 255, 255",
      }).then(blob => blobToBase64(blob)).then(base64 => {
        resolve({
          dataURI: base64,
          ketData: struct,
        });
      }).catch(reject);
    }).catch(reject);
  });
}
// Make the function accessible from the parent window
  window.getData = getData;
</script>
</body>
>>>>>>> 8fafa38822f45799844cf5b9c80942d0335f57bd
</html>
